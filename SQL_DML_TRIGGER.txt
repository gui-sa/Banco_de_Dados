DROP TRIGGER atualiza_usuarios ON CONSUMIDOR_FAMINTO;

SET SEARCH_PATH TO DELIVERY;

CREATE OR REPLACE FUNCTION altera_demais_usuarios()

RETURNS trigger AS $altera_demais_usuarios$
	
	DECLARE V_CONT INTEGER;
	
	BEGIN
	
	--ENTREGADOR NOME
	IF NEW.nome != (SELECT ENTREGADOR.nome
					FROM ENTREGADOR
					WHERE ID=OLD.ID) THEN
			UPDATE ENTREGADOR
			SET nome = NEW.nome
			WHERE ID=OLD.ID;
	END IF;
	
	--DONO_DE_NEGOCIO NOME
	IF NEW.nome != (SELECT DONO_DE_NEGOCIO.nome
					FROM DONO_DE_NEGOCIO
					WHERE ID=OLD.ID) THEN
			UPDATE DONO_DE_NEGOCIO
			SET nome = NEW.nome
			WHERE ID=OLD.ID;
	END IF;
	
	--ENTREGADOR data_nasc
	IF NEW.data_nasc != (SELECT ENTREGADOR.data_nasc
					FROM ENTREGADOR
					WHERE ID=OLD.ID) THEN
			UPDATE ENTREGADOR
			SET data_nasc = NEW.data_nasc
			WHERE ID=OLD.ID;
	END IF;
	
	--DONO_DE_NEGOCIO data_nasc
	IF NEW.data_nasc != (SELECT DONO_DE_NEGOCIO.data_nasc
					FROM DONO_DE_NEGOCIO
					WHERE ID=OLD.ID) THEN
			UPDATE DONO_DE_NEGOCIO
			SET data_nasc = NEW.data_nasc
			WHERE ID=OLD.ID;
	END IF;
	
	--ENTREGADOR endereco
	IF NEW.endereco != (SELECT ENTREGADOR.endereco
					FROM ENTREGADOR
					WHERE ID=OLD.ID) THEN
			UPDATE ENTREGADOR
			SET endereco = NEW.endereco
			WHERE ID=OLD.ID;
	END IF;
	
	--DONO_DE_NEGOCIO endereco
	IF NEW.endereco != (SELECT DONO_DE_NEGOCIO.endereco
					FROM DONO_DE_NEGOCIO
					WHERE ID=OLD.ID) THEN
			UPDATE DONO_DE_NEGOCIO
			SET endereco = NEW.endereco
			WHERE ID=OLD.ID;
	END IF;
		
		RETURN NULL;
	END
$altera_demais_usuarios$ language 'plpgsql';

CREATE TRIGGER atualiza_usuarios
AFTER UPDATE OF nome, data_nasc, endereco ON CONSUMIDOR_FAMINTO -- OR BEFORE UPDATE OF Faltas ON MATRICULA
FOR EACH ROW
EXECUTE PROCEDURE altera_demais_usuarios();

--=============================================================

UPDATE CONSUMIDOR_FAMINTO
SET nome = 'TESTE1', endereco='rua fake', data_nasc='01/01/2001'
WHERE ID=1;

SELECT * FROM TESTE

SELECT * FROM CONSUMIDOR_FAMINTO;
SELECT * FROM DONO_DE_NEGOCIO;
SELECT * FROM ENTREGADOR;

--SELECT * FROM CONSUMIDOR_FAMINTO
--DROP TRIGGER atualiza_usuarios ON CONSUMIDOR_FAMINTO